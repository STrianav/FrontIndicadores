import{a as I,b as oe,c as H}from"./chunk-TNF5RKJF.js";import{a as q}from"./chunk-F6LDSNR5.js";import{a as j,b as E,c as $,d as K,f as re,h as P,i as R,j as L,k as z,l as B,m as U,n as J,o as k}from"./chunk-TGO5R4BE.js";import{g as G,h as S,i as F}from"./chunk-YSL4L367.js";import{$ as ie,Eb as D,Fb as d,Gb as u,Hb as O,Mb as ne,Na as o,Pb as A,Ta as w,W as te,Xa as C,a as ee,aa as h,ab as p,d as b,ha as _,ia as v,jb as Y,kb as s,ob as l,pb as a,qb as M,r as x,rb as N,sb as V,tb as g,xb as f,yb as c}from"./chunk-RCD2EZCC.js";function de(n,i){if(n&1&&(l(0,"div",19),d(1),a()),n&2){let e=c(2).$implicit;o(),O(" Por favor, revise el campo ",e.label,". ")}}function me(n,i){if(n&1&&(l(0,"div")(1,"label",16),d(2),a(),M(3,"input",17),p(4,de,2,1,"div",18),a()),n&2){let e,t=c().$implicit,r=c();o(),Y("for",t.name),o(),u(t.label),o(),s("type",t.type)("formControlName",t.name)("id",t.name),o(),s("ngIf",((e=r.form.get(t.name))==null?null:e.invalid)&&((e=r.form.get(t.name))==null?null:e.touched))}}function pe(n,i){if(n&1&&(N(0),l(1,"option",24),d(2),a(),V()),n&2){let e=i.$implicit,t=c(3);o(),s("value",t.formatValue(e)),o(),u(t.formatOption(e))}}function ue(n,i){if(n&1&&(l(0,"div")(1,"label",20),d(2),a(),l(3,"select",21)(4,"option",22),d(5,"Seleccione una opci\xF3n"),a(),p(6,pe,3,2,"ng-container",23),a()()),n&2){let e=c().$implicit,t=c();o(),Y("for",e.name),o(),u(e.label),o(),s("formControlName",e.name),o(3),s("ngForOf",t.foreignData[e.name])}}function fe(n,i){if(n&1&&(l(0,"div",14),p(1,me,5,6,"div",15)(2,ue,7,4,"div",15),a()),n&2){let e=i.$implicit,t=c();s("ngClass",t.columnClass),o(),s("ngIf",!e.fk),o(),s("ngIf",e.fk)}}function _e(n,i){if(n&1){let e=g();l(0,"button",25),f("click",function(){_(e);let r=c();return v(r.onSave())}),d(1,"Guardar"),a()}}function ve(n,i){if(n&1){let e=g();l(0,"button",26),f("click",function(){_(e);let r=c();return v(r.onEdit())}),d(1,"Editar"),a()}}function ge(n,i){if(n&1){let e=g();l(0,"button",27),f("click",function(){_(e);let r=c();return v(r.onDelete())}),d(1,"Eliminar"),a()}}var Q=class n{constructor(i,e,t){this.fb=i;this.api=e;this.generalService=t}formSchema;Tabla="";crudd="C";activeModal=h(I);form;originalData;TablaForanea;foreignData={};ngOnInit(){this.createForm(),this.loadForeignKeys(),this.originalData=ee({},this.form.value)}get modalSize(){let i=this.formSchema?.fields?.length||0;return i>12?"modal-xl":i>6?"modal-lg":""}get columnClass(){let i=this.formSchema?.fields?.length||0;return i>20?"col-12 col-md-4 col-lg-3":i>12?"col-12 col-md-6 col-lg-4":i>6?"col-12 col-md-6":"col-12"}createForm(){let i={};this.formSchema.fields.forEach(e=>{let t=this.castValueByType(e.value,e.type);i[e.name]=[t,this.getValidators(e.validators)]}),this.form=this.fb.group(i)}castValueByType(i,e){switch(e){case"number":return Number(i);case"boolean":return i==="true"||i===!0;case"string":default:return String(i)}}getValidators(i){let e=[];return i&&i.forEach(t=>{t==="required"&&e.push(E.required),t==="email"&&e.push(E.email)}),e}onSave(){return b(this,null,function*(){if(this.form.valid)try{yield x(this.api.CrearData(this.Tabla,this.form.value)),this.generalService.showAlert("Se guard\xF3 correctamente.","success",!0,2500).then(()=>{this.activeModal.close()})}catch(i){i.status===200?this.generalService.showAlert("Se guard\xF3 correctamente.","success",!0,2500).then(()=>{this.activeModal.close()}):this.generalService.showAlert("No se pudo guardar la informaci\xF3n, int\xE9ntalo m\xE1s tarde.","error",!1,0)}else this.form.markAllAsTouched()})}onEdit(){if(this.form.valid){let i=this.originalData||{},e=Object.keys(this.form.value).reduce((y,T)=>(this.form.value[T]!==i[T]&&(y[T]=this.form.value[T]),y),{}),r=Object.keys(i)[0],m=i[r];Object.keys(e).length>0?this.api.EditarData(this.Tabla,r,m,e).subscribe(y=>{},y=>{y.status==200?this.generalService.showAlert("Se edito correctamente.","success",!0,2500).then(()=>{this.activeModal.close()}):this.generalService.showAlert("No se pudo editar la informaci\xF3n, intentalo mas tarde.","error",!1,0)}):alert("No hay cambios para actualizar.")}else this.form.markAllAsTouched()}onDelete(){if(this.form.valid){let i=this.originalData||{},e=Object.keys(i)[0],t=i[e];if(!e||!t){alert("No se pudo determinar el identificador del registro a eliminar.");return}this.api.EliminarData(this.Tabla,e,t).subscribe(r=>{},r=>{r.status==200?this.generalService.showAlert("Se elimino correctamente.","success",!0,2500).then(()=>{this.activeModal.close()}):this.generalService.showAlert("No se pudo eliminar la informaci\xF3n, intentalo mas tarde.","error",!1,0)})}else this.form.markAllAsTouched()}loadForeignKeys(){return b(this,null,function*(){let i=[];for(let e of this.formSchema.fields)e.fk&&i.push(yield this.getForeignData(e.strTable).then(t=>(this.foreignData[e.name]=t,{field:e.name,data:t})).catch(t=>(console.error(`Error cargando datos para ${e.name}:`,t),this.foreignData[e.name]=[],{field:e.name,error:t})));try{return yield Promise.all(i)}catch(e){return console.error("Error al cargar datos:",e),[]}})}getForeignData(i){return b(this,null,function*(){try{if(!i)throw new Error("Nombre de la tabla no definido");return yield x(this.api.TraerTabla(i))}catch(e){return console.error(`Error al obtener datos de la tabla "${i}":`,e),[]}})}formatValue(i){let e=Object.keys(i);if(this.Tabla==="rol_usuario")return i[e[0]];for(let t of e){let r=Number(i[t]);if(!isNaN(r))return r}return String(i[e[0]])}formatOption(i){return Object.entries(i).filter(([t,r])=>!t.toLowerCase().includes("id")).map(([t,r])=>r).join(" - ")}cancel(){this.activeModal.dismiss(!1)}static \u0275fac=function(e){return new(e||n)(w(J),w(q),w(H))};static \u0275cmp=C({type:n,selectors:[["app-formulariodinamico"]],inputs:{formSchema:"formSchema",Tabla:"Tabla",crudd:"crudd"},decls:15,vars:7,consts:[["tabindex","-1","role","dialog",1,"modal","fade","show","d-block"],["role","document",1,"modal-dialog",3,"ngClass"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[3,"formGroup"],[1,"row"],["class","mb-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","class","btn btn-success",3,"click",4,"ngIf"],["type","button","class","btn btn-primary",3,"click",4,"ngIf"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],[1,"mb-3",3,"ngClass"],[4,"ngIf"],[1,"form-label","disabled"],[1,"form-control",3,"type","formControlName","id"],["class","text-danger",4,"ngIf"],[1,"text-danger"],[1,"form-label"],[1,"form-select",3,"formControlName"],["value",""],[4,"ngFor","ngForOf"],[3,"value"],["type","button",1,"btn","btn-success",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,t){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),d(5),a(),l(6,"button",5),f("click",function(){return t.cancel()}),a()(),l(7,"div",6)(8,"form",7)(9,"div",8),p(10,fe,3,3,"div",9),a()()(),l(11,"div",10),p(12,_e,2,0,"button",11)(13,ve,2,0,"button",12)(14,ge,2,0,"button",13),a()()()()),e&2&&(o(),s("ngClass",t.modalSize),o(4),u(t.Tabla),o(3),s("formGroup",t.form),o(2),s("ngForOf",t.formSchema.fields),o(2),s("ngIf",t.crudd==="C"),o(),s("ngIf",t.crudd==="U"),o(),s("ngIf",t.crudd==="D"))},dependencies:[k,G,S,F,P,B,U,j,z,$,K,R,L],encapsulation:2})};var be=n=>({active:n});function he(n,i){if(n&1){let e=g();l(0,"li",18)(1,"a",19),f("click",function(){let r=_(e).index,m=c();return v(m.goToStep(r))}),d(2),a()()}if(n&2){let e=i.$implicit,t=i.index,r=c();o(),s("ngClass",ne(2,be,r.currentStep===t)),o(),u(e)}}function ye(n,i){if(n&1&&(l(0,"div",25),d(1),a()),n&2){let e=c(2).$implicit,t=c();o(),O(" Por favor, revise el campo ",t.getLabel(t.currentStep,e),". ")}}function xe(n,i){if(n&1&&(N(0),l(1,"label",22),d(2),a(),M(3,"input",23),p(4,ye,2,1,"div",24),V()),n&2){let e,t=c().$implicit,r=c();o(2),u(r.getLabel(r.currentStep,t)),o(),s("type",r.getType(r.currentStep,t))("formControlName",t),o(),s("ngIf",((e=r.formGroups[r.currentStep].get(t))==null?null:e.invalid)&&((e=r.formGroups[r.currentStep].get(t))==null?null:e.touched))}}function Ce(n,i){if(n&1&&(l(0,"option",29),d(1),a()),n&2){let e=i.$implicit;s("value",e.id),o(),u(e.label)}}function Se(n,i){if(n&1&&(l(0,"label",22),d(1),a(),l(2,"select",26)(3,"option",27),d(4,"Seleccione una opci\xF3n"),a(),p(5,Ce,2,2,"option",28),a()),n&2){let e=c().$implicit,t=c();o(),u(t.getLabel(t.currentStep,e)),o(),s("formControlName",e),o(3),s("ngForOf",t.getFKOptions(e))}}function Fe(n,i){if(n&1&&(l(0,"div",20),p(1,xe,5,4,"ng-container",21)(2,Se,6,3,"ng-template",null,0,A),a()),n&2){let e=i.$implicit,t=D(3),r=c();o(),s("ngIf",!r.isFK(r.currentStep,e))("ngIfElse",t)}}function Ie(n,i){if(n&1&&(l(0,"th"),d(1),a()),n&2){let e=i.$implicit,t=c(2);o(),u(t.getLabel(t.currentStep,e))}}function ke(n,i){if(n&1&&(l(0,"td"),d(1),a()),n&2){let e=i.$implicit,t=c().$implicit;o(),u(t[e])}}function Ee(n,i){if(n&1){let e=g();l(0,"tr"),p(1,ke,2,1,"td",33),l(2,"td")(3,"button",34),f("click",function(){let r=_(e).index,m=c(2);return v(m.removeEntry(r))}),d(4,"Eliminar"),a()()()}if(n&2){let e=c(2);o(),s("ngForOf",e.formKeys[e.currentStep])}}function Te(n,i){if(n&1){let e=g();l(0,"div",30)(1,"button",31),f("click",function(){_(e);let r=c();return v(r.addEntry())}),d(2,"Agregar"),a(),l(3,"table",32)(4,"thead")(5,"tr"),p(6,Ie,2,1,"th",33),l(7,"th"),d(8,"Acciones"),a()()(),l(9,"tbody"),p(10,Ee,5,1,"tr",33),a()()()}if(n&2){let e=c();o(6),s("ngForOf",e.formKeys[e.currentStep]),o(4),s("ngForOf",e.listEntries[e.currentStep])}}function we(n,i){if(n&1){let e=g();l(0,"button",35),f("click",function(){_(e);let r=c();return v(r.nextStep())}),d(1,"Siguiente"),a()}}function Me(n,i){if(n&1){let e=g();l(0,"button",36),f("click",function(){_(e);let r=c();return v(r.onSave())}),d(1,"Guardar"),a()}}var W=class n{activeModal=h(I);fb=h(J);api=h(q);general=h(H);Formulario={};steps=[];currentStep=0;formGroups=[];formKeys=[];listEntries=[];foreignData={};constructor(){this.Formulario={indicador:[{name:"codigo",label:"C\xF3digo",type:"text",validators:["required"]},{name:"nombre",label:"Nombre",type:"text",validators:["required"]},{name:"objetivo",label:"Objetivo",type:"text",validators:["required"]},{name:"alcance",label:"Alcance",type:"text",validators:["required"]},{name:"formula",label:"F\xF3rmula",type:"text",validators:["required"]},{name:"fkidtipoindicador",label:"Tipo de Indicador ",type:"text",fk:!0,strTable:"tipoindicador",validators:["required"]},{name:"fkidunidadmedicion",label:"Unidad de Medici\xF3n",type:"text",fk:!0,strTable:"unidadmedicion",validators:["required"]},{name:"meta",label:"Meta",type:"text",validators:["required"]},{name:"fkidsentido",label:"Sentido",type:"text",fk:!0,strTable:"sentido",validators:["required"]},{name:"fkidfrecuencia",label:"Frecuencia",type:"text",fk:!0,strTable:"frecuencia",validators:["required"]},{name:"fkidarticulo",label:"Art\xEDculo",type:"text",fk:!0,strTable:"articulo",validators:["required"]},{name:"fkidliteral",label:"Literal",type:"text",fk:!0,strTable:"literal",validators:["required"]},{name:"fkidnumeral",label:"Numeral",type:"text",fk:!0,strTable:"numeral",validators:["required"]},{name:"fkidparagrafo",label:"Paragrafo",type:"text",fk:!0,strTable:"paragrafo",validators:["required"]}],responsablesporindicador:[{name:"fkidresponsable",label:"Actor",type:"text",fk:!0,strTable:"actor",validators:["required"]},{name:"fechaasignacion",label:"Fecha asignaci\xF3n",type:"datetime"}],resultadoindicador:[{name:"resultado",label:"C\xF3digo",type:"float",validators:["required"]},{name:"fechacalculo",label:"Fecha calculo",type:"datetime"}],variablesporindicador:[{name:"fkidvariable",label:"Variable",type:"text",fk:!0,strTable:"variable",validators:["required"]},{name:"fkemailusuario",label:"Email",type:"text",fk:!0,strTable:"usuario",validators:["required"]},{name:"dato",label:"Dato",type:"float",validators:["required"]},{name:"fechadato",label:"Fecha Dato",type:"datetime"}],represenvisualporindicador:[{name:"fkidrepresenvisual",label:"Represen Visual",type:"text",fk:!0,strTable:"represenvisual",validators:["required"]}]},this.steps=Object.keys(this.Formulario)}ngOnInit(){return b(this,null,function*(){this.steps=Object.keys(this.Formulario),this.steps.forEach((i,e)=>{let t={},r=[];this.Formulario[i].forEach(m=>{if(!m.name)return;let y=m.validators?.includes("required")?[E.required]:[];t[m.name]=new re("",y),r.push(m.name)}),this.formGroups.push(this.fb.group(t)),this.formKeys.push(r),this.listEntries.push([])}),yield this.loadForeignKeys()})}loadForeignKeys(){return b(this,null,function*(){try{for(let i of this.steps){let e=this.Formulario[i];for(let t of e)if(t.fk&&t.strTable&&!this.foreignData[t.name]){let r=yield this.getForeignData(t.strTable);this.foreignData[t.name]=r.map(m=>({id:m.id||m.Id||m.codigo||m.codigo_id||m.pk||m.email||m[t.name]||"SIN_ID",label:m.nombre||m.descripcion||m.label||m.email||JSON.stringify(m)}))}}}catch(i){console.error("\u26D4 Error cr\xEDtico: Deteniendo carga de claves for\xE1neas:",i)}})}getForeignData(i){return b(this,null,function*(){try{if(!i)throw new Error("Nombre de tabla no definido");return yield x(this.api.TraerTabla(i))}catch(e){return console.error(`Error al obtener datos de la tabla "${i}":`,e),[]}})}cancel(){this.activeModal.dismiss(!1)}getLabel(i,e){return this.Formulario[this.steps[i]].find(t=>t.name===e)?.label||e}getType(i,e){let t=this.Formulario[this.steps[i]].find(r=>r.name===e)?.type;return t==="datetime"?"datetime-local":t==="float"?"number":t||"text"}isFK(i,e){return this.Formulario[this.steps[i]].some(t=>t.name===e&&t.fk)}getFKOptions(i){return this.foreignData[i]||[]}goToStep(i){this.currentStep=i}nextStep(){this.currentStep<this.steps.length-1&&this.currentStep++}prevStep(){this.currentStep>0&&this.currentStep--}addEntry(){this.formGroups[this.currentStep].valid&&(this.listEntries[this.currentStep].push(this.formGroups[this.currentStep].value),this.formGroups[this.currentStep].reset())}removeEntry(i){this.listEntries[this.currentStep].splice(i,1)}onSave(){return b(this,null,function*(){let i={};this.steps.forEach((t,r)=>{r===0?i[t]=this.formGroups[r].value:i[t]=this.listEntries[r]});let e=yield x(this.api.GuardarIndicador(i));(e.mensaje="Indicador y sus relaciones guardados correctamente")?this.general.showAlert(e.mensaje,"success",!0,3e3).then(()=>{this.activeModal.close(!0)}):this.general.showAlert("No se pudo guardar la informaci\xF3n. Por favor, verifica que todos los campos est\xE9n correctamente diligenciados.","error",!1,0)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=C({type:n,selectors:[["app-Modal-indicador"]],decls:19,vars:8,consts:[["fkTemplate",""],["tabindex","-1","role","dialog",1,"modal","fade","show","d-block"],["role","document",1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"nav","nav-tabs","mb-3"],["class","nav-item",4,"ngFor","ngForOf"],[3,"formGroup"],[1,"row"],["class","mb-3 col-md-6",4,"ngFor","ngForOf"],["class","mt-3",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click","disabled"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","btn btn-success",3,"click",4,"ngIf"],[1,"nav-item"],[1,"nav-link",3,"click","ngClass"],[1,"mb-3","col-md-6"],[4,"ngIf","ngIfElse"],[1,"form-label"],[1,"form-control",3,"type","formControlName"],["class","text-danger",4,"ngIf"],[1,"text-danger"],[1,"form-select",3,"formControlName"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mt-3"],[1,"btn","btn-secondary","mb-2",3,"click"],[1,"table","table-sm","table-bordered"],[4,"ngFor","ngForOf"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-success",3,"click"]],template:function(e,t){e&1&&(l(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),d(5),a(),l(6,"button",6),f("click",function(){return t.cancel()}),a()(),l(7,"div",7)(8,"ul",8),p(9,he,3,4,"li",9),a(),l(10,"form",10)(11,"div",11),p(12,Fe,4,2,"div",12),a()(),p(13,Te,11,2,"div",13),a(),l(14,"div",14)(15,"button",15),f("click",function(){return t.prevStep()}),d(16,"Anterior"),a(),p(17,we,2,0,"button",16)(18,Me,2,0,"button",17),a()()()()),e&2&&(o(5),u("Indicador"),o(4),s("ngForOf",t.steps),o(),s("formGroup",t.formGroups[t.currentStep]),o(2),s("ngForOf",t.formKeys[t.currentStep]),o(),s("ngIf",t.currentStep>0),o(2),s("disabled",t.currentStep===0),o(2),s("ngIf",t.currentStep<t.steps.length-1),o(),s("ngIf",t.currentStep===t.steps.length-1))},dependencies:[k,G,S,F,P,B,U,j,z,$,K,R,L],encapsulation:2})};function Ne(n,i){if(n&1&&(l(0,"th"),d(1),a()),n&2){let e=i.$implicit;o(),u(e)}}function Ve(n,i){if(n&1&&(l(0,"td"),d(1),a()),n&2){let e=i.$implicit,t=c().$implicit;o(),u(t[e])}}function De(n,i){if(n&1&&(l(0,"tr"),p(1,Ve,2,1,"td",12),a()),n&2){let e=c(2);o(),s("ngForOf",e.columnas)}}function Oe(n,i){if(n&1&&(l(0,"div")(1,"div",9)(2,"table",10)(3,"thead",11)(4,"tr"),p(5,Ne,2,1,"th",12),a()(),l(6,"tbody"),p(7,De,2,1,"tr",12),a()()()()),n&2){let e=c();o(5),s("ngForOf",e.columnas),o(2),s("ngForOf",e.data)}}function Ae(n,i){n&1&&(l(0,"p"),d(1,"No hay datos para mostrar."),a())}var X=class n{data=[];Consulta;columnas=[];activeModal=h(I);ngOnInit(){this.data?.length?this.columnas=Object.keys(this.data[0]):this.columnas=[]}cancel(){this.activeModal.dismiss(!1)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=C({type:n,selectors:[["app-Consultas"]],inputs:{data:"data",Consulta:"Consulta"},decls:11,vars:3,consts:[["sinDatos",""],["tabindex","-1","role","dialog",1,"modal","fade","show","d-block"],["role","document",1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[4,"ngIf","ngIfElse"],[1,"table-responsive"],[1,"table","table-hover","custom-table","mt-3"],[1,"table-dark"],[4,"ngFor","ngForOf"]],template:function(e,t){if(e&1){let r=g();l(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),d(5),a(),l(6,"button",6),f("click",function(){return _(r),v(t.cancel())}),a()(),l(7,"div",7),p(8,Oe,8,2,"div",8)(9,Ae,2,0,"ng-template",null,0,A),a()()()()}if(e&2){let r=D(10);o(5),u(t.Consulta),o(3),s("ngIf",t.data.length>0)("ngIfElse",r)}},dependencies:[k,S,F],encapsulation:2})};var se=class n{constructor(i){this.modalService=i}openDynamicModal(i,e,t){let r=this.modalService.open(Q,{size:"xl",backdrop:"static"});return r.componentInstance.formSchema=i,r.componentInstance.crudd=e,r.componentInstance.Tabla=t,r}openConsultas(i,e){let t=this.modalService.open(X,{size:"xl",backdrop:"static"});return t.componentInstance.data=i,t.componentInstance.Consulta=e,t}openModalIndicador(){return this.modalService.open(W,{size:"xxl",backdrop:"static"})}static \u0275fac=function(e){return new(e||n)(ie(oe))};static \u0275prov=te({token:n,factory:n.\u0275fac,providedIn:"root"})};export{se as a};
