import{h as x}from"./chunk-2UNL2BHA.js";import{g as C}from"./chunk-YOE35VFI.js";import{a as A}from"./chunk-F6LDSNR5.js";import{a as F,b as s,c as I,d as w,e as E,h as L,i as M,j as N,n as O,o as j}from"./chunk-TGO5R4BE.js";import{p as y}from"./chunk-YSL4L367.js";import{$ as v,Fb as a,Na as g,Ta as n,W as f,Xa as h,d as p,kb as S,ob as o,pb as i,qb as d,r as u,xb as b}from"./chunk-RCD2EZCC.js";var m=class{email="";contrasena=""};var c=class r{constructor(t){this.http=t}apiLocal="http://indicadores.runasp.net/api/Auth";login(t){return this.http.post(`${this.apiLocal}/login`,t)}obtenerRol(t){return this.http.get(`${this.apiLocal}/obtener-rol`,{params:{email:t}})}static \u0275fac=function(e){return new(e||r)(v(y))};static \u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"})};var B=class r{constructor(t,e,l,D,V){this.formBuilder=t;this.apiServiceAuthService=e;this.apiService=l;this.router=D;this.toastr=V}formLogin=new E({});loginModel=new m;datosUsuario="";contrase\u00F1a="";ngOnInit(){this.validateForm(this.loginModel)}verificarContrasena(t,e){return p(this,null,function*(){try{return yield u(this.apiService.VerificarContrasena(t,e))}catch(l){console.error("Error al verificar la contrase\xF1a:",l)}})}Login(){return p(this,null,function*(){if(this.formLogin.valid)if(this.loginModel=this.formLogin.value,yield this.verificarContrasena(this.loginModel.email,this.loginModel.contrasena))try{let e=yield u(this.apiServiceAuthService.login(this.loginModel));if(!e||!e.token){this.toastr.error("No se recibi\xF3 un token v\xE1lido","Error",{timeOut:3e3,progressBar:!0,tapToDismiss:!1});return}sessionStorage.setItem("token",e.token),sessionStorage.setItem("email",e.email),sessionStorage.setItem("roles",JSON.stringify(e.roles)),sessionStorage.setItem("rutas",JSON.stringify(e.rutas)),this.toastr.success("Has iniciado sesi\xF3n","\xC9xito",{timeOut:3e3,progressBar:!0,tapToDismiss:!1}),this.router.navigate(["navegador/inicio"])}catch(e){console.error("Error de autenticaci\xF3n:",e)}else this.toastr.error("Correo o contrase\xF1a incorrectos.","Error",{timeOut:3e3,progressBar:!0,tapToDismiss:!1});else this.showValidationMessages()})}showValidationMessages(){let t={email:"El campo correo Electr\xF3nico es obligatorio.",contrasena:"El campo contrase\xF1a es obligatorio."};Object.keys(t).forEach(e=>{this.formLogin.controls[e].invalid&&this.toastr.warning(t[e],"Atencion",{timeOut:3e3,progressBar:!0,tapToDismiss:!1})})}validateForm(t){return new Promise(e=>{this.formLogin=this.formBuilder.group({email:[t.email,[s.required,s.email,s.minLength(1)]],contrasena:[t.contrasena,[s.required,s.minLength(1)]]}),e(!0)})}static \u0275fac=function(e){return new(e||r)(n(O),n(c),n(A),n(C),n(x))};static \u0275cmp=h({type:r,selectors:[["app-auth"]],decls:24,vars:1,consts:[[1,"container","mt-5"],[1,"row","justify-content-center"],[1,"col-md-6","col-lg-5"],[1,"card","shadow"],[1,"card-body"],[1,"card-title","text-center","mb-4"],[3,"formGroup"],[1,"mb-3"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","nombre@ejemplo.com",1,"form-control"],["for","password",1,"form-label"],["type","password","id","password","formControlName","contrasena","placeholder","Contrase\xF1a",1,"form-control"],[1,"d-grid","mb-3"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-center"],["href",""]],template:function(e,l){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3",5),a(6,"Iniciar Sesi\xF3n"),i(),o(7,"form",6)(8,"div",7)(9,"label",8),a(10,"Correo Electr\xF3nico"),i(),d(11,"input",9),i(),o(12,"div",7)(13,"label",10),a(14,"Contrase\xF1a"),i(),d(15,"input",11),i(),o(16,"div",12)(17,"button",13),b("click",function(){return l.Login()}),a(18,"Iniciar Sesi\xF3n"),i()()(),o(19,"div",14)(20,"p"),a(21,"\xBFNo tienes una cuenta? "),o(22,"a",15),a(23,"Reg\xEDstrate"),i()()()()()()()()),e&2&&(g(7),S("formGroup",l.formLogin))},dependencies:[j,L,F,I,w,M,N],encapsulation:2})};export{B as AuthComponent};
